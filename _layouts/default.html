<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    {% seo %}
    
    <link rel="stylesheet" href="{{ '/assets/css/main.css' | relative_url }}">
    <link rel="alternate" type="application/rss+xml" title="{{ site.title }}" href="{{ '/feed.xml' | relative_url }}">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="{{ '/assets/favicon.svg' | relative_url }}">
    
    <!-- 字体图标 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="wrapper">
        <!-- 导航栏 -->
        <nav class="navbar">
            <div class="container">
                <!-- 时钟和天气 -->
                <div class="nav-weather-clock">
                    <div class="nav-clock-item">
                        <span class="nav-clock-date" id="nav-clock-date">2025年12月20日</span>
                        <span class="nav-clock-time" id="nav-clock-time">00:00:00</span>
                    </div>
                    <div class="nav-weather-item" id="nav-weather-item" title="">
                        <i class="fas fa-cloud-sun"></i>
                        <span class="nav-weather-info" id="nav-weather-info">南京 --°C</span>
                    </div>
                </div>
                <div class="nav-brand">
                    <a href="{{ '/' | relative_url }}" aria-label="返回首页">{{ site.title }}</a>
                </div>
                <ul class="nav-menu">
                    {% for item in site.navigation %}
                    <li>
                        <a href="{{ item.url | relative_url }}" {% if page.url == item.url %}class="active"{% endif %}>
                            {{ item.title }}
                        </a>
                    </li>
                    {% endfor %}
                </ul>
                <button class="nav-toggle" aria-label="切换菜单" id="nav-toggle">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </nav>

        <!-- 主要内容 -->
        <main class="main-content">
            {{ content }}
        </main>

        <!-- 页脚 -->
        <footer class="footer">
            <div class="container">
                <div class="footer-content">
                    <div class="footer-section">
                        <h3>关于</h3>
                        <p>{{ site.description }}</p>
                    </div>
                    <div class="footer-section">
                        <h3>社交链接</h3>
                        <div class="social-links">
                            <a href="{{ site.social_links.github }}" target="_blank" rel="noopener noreferrer" aria-label="GitHub">
                                <i class="fab fa-github"></i>
                            </a>
                            <a href="{{ site.social_links.zhihu }}" target="_blank" rel="noopener noreferrer" aria-label="知乎">
                                <i class="fab fa-zhihu"></i>
                            </a>
                            <a href="{{ site.social_links.csdn }}" target="_blank" rel="noopener noreferrer" aria-label="CSDN">
                                <i class="fas fa-blog"></i>
                            </a>
                        </div>
                    </div>
                    <div class="footer-section">
                        <h3>订阅</h3>
                        <p>
                            <a href="{{ '/feed.xml' | relative_url }}">RSS Feed</a>
                        </p>
                    </div>
                </div>
                <div class="footer-bottom">
                    <p>&copy; {{ 'now' | date: "%Y" }} {{ site.author.name }}. 保留所有权利.</p>
                    <p>由 <a href="https://pages.github.com/" target="_blank">GitHub Pages</a> 托管</p>
                </div>
            </div>
        </footer>
    </div>

    <script src="{{ '/assets/js/main.js' | relative_url }}"></script>
    <script>
        // 移动端菜单切换
        document.getElementById('nav-toggle')?.addEventListener('click', function() {
            const menu = document.querySelector('.nav-menu');
            menu.classList.toggle('active');
        });

        // 实时时钟 - 直接在页面底部执行，确保导航栏已渲染
        (function initClock() {
            function updateClock() {
                const navClockDateEl = document.getElementById('nav-clock-date');
                const navClockTimeEl = document.getElementById('nav-clock-time');
                if (navClockDateEl && navClockTimeEl) {
                    const now = new Date();
                    const year = now.getFullYear();
                    const month = String(now.getMonth() + 1).padStart(2, '0');
                    const day = String(now.getDate()).padStart(2, '0');
                    const hours = String(now.getHours()).padStart(2, '0');
                    const minutes = String(now.getMinutes()).padStart(2, '0');
                    const seconds = String(now.getSeconds()).padStart(2, '0');
                    
                    navClockDateEl.textContent = `${year}年${month}月${day}日`;
                    navClockTimeEl.textContent = `${hours}:${minutes}:${seconds}`;
                }
            }
            
            // 立即更新一次
            updateClock();
            // 每秒更新
            setInterval(updateClock, 1000);
        })();

        // 获取天气信息 - 直接在页面底部执行
        (function initWeather() {
            const cityName = '南京';
            const navWeatherItem = document.getElementById('nav-weather-item');
            const navWeatherInfoEl = document.getElementById('nav-weather-info');
            
            function getWeather() {
                if (!navWeatherInfoEl || !navWeatherItem) return;

                // 使用Open-Meteo免费API（更稳定）
                fetch(`https://api.open-meteo.com/v1/forecast?latitude=32.0603&longitude=118.7969&current=temperature_2m,weather_code&daily=temperature_2m_max,temperature_2m_min&timezone=Asia/Shanghai`)
                    .then(response => response.json())
                    .then(data => {
                        if (data && data.current && data.daily) {
                            const current = data.current;
                            const daily = data.daily;
                            const temp = Math.round(current.temperature_2m);
                            const tempMax = Math.round(daily.temperature_2m_max[0]);
                            const tempMin = Math.round(daily.temperature_2m_min[0]);
                            
                            // 天气代码转中文描述
                            const weatherCodes = {
                                0: '晴朗', 1: '大部分晴朗', 2: '部分多云', 3: '阴天',
                                45: '雾', 48: '霜雾', 51: '小雨', 53: '中雨', 55: '大雨',
                                61: '小雨', 63: '中雨', 65: '大雨', 71: '小雪', 73: '中雪', 75: '大雪',
                                80: '小雨', 81: '中雨', 82: '大雨', 85: '小雪', 86: '大雪',
                                95: '雷暴', 96: '雷暴冰雹', 99: '强雷暴冰雹'
                            };
                            const weatherDesc = weatherCodes[current.weather_code] || '未知';
                            
                            // 更新显示
                            navWeatherInfoEl.textContent = `${cityName} ${tempMin}°C~${tempMax}°C`;
                            navWeatherItem.setAttribute('title', weatherDesc);
                        } else {
                            throw new Error('天气数据格式错误');
                        }
                    })
                    .catch(error => {
                        console.error('获取天气失败:', error);
                        // 备用方案：使用wttr.in
                        fetch(`https://wttr.in/Nanjing?format=j1&lang=zh`)
                            .then(response => response.json())
                            .then(data => {
                                if (data && data.current_condition && data.current_condition[0]) {
                                    const current = data.current_condition[0];
                                    const temp = current.temp_C;
                                    const tempMax = current.temp_C || temp;
                                    const tempMin = current.temp_C || temp;
                                    const desc = current.lang_zh ? current.lang_zh[0].value : (current.weatherDesc ? current.weatherDesc[0].value : '未知');
                                    
                                    navWeatherInfoEl.textContent = `${cityName} ${tempMin}°C~${tempMax}°C`;
                                    navWeatherItem.setAttribute('title', desc);
                                } else {
                                    navWeatherInfoEl.textContent = `${cityName} --°C`;
                                    navWeatherItem.setAttribute('title', '无法获取天气');
                                }
                            })
                            .catch(() => {
                                navWeatherInfoEl.textContent = `${cityName} --°C`;
                                navWeatherItem.setAttribute('title', '无法获取天气');
                            });
                    });
            }
            
            // 立即获取天气
            getWeather();
            // 每30分钟更新一次
            setInterval(getWeather, 30 * 60 * 1000);
        })();
    </script>
</body>
</html>

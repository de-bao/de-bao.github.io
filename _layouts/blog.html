---
layout: default
---
<div class="blog-page">
    <div class="container">
        <header class="page-header" style="text-align: center; margin-bottom: 3rem; padding-top: 2rem;">
            <h1>åšå®¢æ–‡ç« </h1>
            <p style="font-size: 1.1rem; margin-top: 1rem; opacity: 0.8;">åˆ†äº«æŠ€æœ¯è§è§£å’Œå­¦ä¹ ç¬”è®°</p>
        </header>

        <!-- ç­›é€‰å™¨ -->
        <div class="blog-filters">
            <!-- æ ‡ç­¾ç­›é€‰ -->
            <div class="filter-section">
                <h3 class="filter-title">æ ‡ç­¾ç­›é€‰</h3>
                <div class="tags-filter">
                    <button class="filter-btn active" data-filter="all">å…¨éƒ¨</button>
                    {% assign all_tags = '' | split: '' %}
                    {% for post in site.posts %}
                        {% for tag in post.tags %}
                            {% unless all_tags contains tag %}
                                {% assign all_tags = all_tags | push: tag %}
                            {% endunless %}
                        {% endfor %}
                    {% endfor %}
                    {% assign all_tags = all_tags | sort %}
                    {% for tag in all_tags %}
                    {% assign tag_posts = site.posts | where_exp: "post", "post.tags contains tag" %}
                    <button class="filter-btn" data-filter="tag" data-value="{{ tag | slugify }}">
                        {{ tag }} <span class="filter-count">({{ tag_posts.size }})</span>
                    </button>
                    {% endfor %}
                </div>
            </div>

            <!-- æ—¶é—´ç­›é€‰ -->
            <div class="filter-section">
                <h3 class="filter-title">æ—¶é—´ç­›é€‰</h3>
                <div class="year-filter">
                    <button class="filter-btn active" data-filter="all">å…¨éƒ¨</button>
                    {% assign posts_by_year = site.posts | group_by_exp: "post", "post.date | date: '%Y'" %}
                    {% for year in posts_by_year %}
                    <button class="filter-btn" data-filter="year" data-value="{{ year.name }}">
                        {{ year.name }}å¹´ <span class="filter-count">({{ year.items.size }})</span>
                    </button>
                    {% endfor %}
                </div>
            </div>

            <!-- æœç´¢æ¡† -->
            <div class="filter-section">
                <h3 class="filter-title">æœç´¢</h3>
                <!-- æœç´¢ç±»å‹åˆ‡æ¢ -->
                <div class="search-type-toggle">
                    <label class="search-type-option">
                        <input type="radio" name="search-type" value="posts" checked>
                        <span>æœç´¢æ–‡ç« æ ‡é¢˜æˆ–å†…å®¹</span>
                    </label>
                    <label class="search-type-option">
                        <input type="radio" name="search-type" value="wiki">
                        <span>æœç´¢ç»´åŸºç™¾ç§‘</span>
                    </label>
                </div>
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="search-input" placeholder="æœç´¢æ–‡ç« æ ‡é¢˜æˆ–å†…å®¹..." class="search-input">
                </div>
                <!-- ç»´åŸºç™¾ç§‘æœç´¢ç»“æœ -->
                <div id="wiki-results" class="wiki-results" style="display: none;"></div>
            </div>
        </div>

        <!-- æ–‡ç« åˆ—è¡¨ -->
        <div class="posts-list" id="posts-list">
            {% if site.posts.size > 0 %}
            {% for post in site.posts %}
            <article class="post-card" 
                     data-tags="{% for tag in post.tags %}{{ tag | slugify }} {% endfor %}"
                     data-year="{{ post.date | date: '%Y' }}"
                     data-title="{{ post.title | downcase }}"
                     data-content="{{ post.excerpt | strip_html | downcase }}">
                <div class="post-card-header">
                    <h2><a href="{{ post.url | relative_url }}">{{ post.title }}</a></h2>
                    <div class="post-meta">
                        <time datetime="{{ post.date | date: '%Y-%m-%d' }}">
                            <i class="far fa-calendar"></i> {{ post.date | date: "%Yå¹´%mæœˆ%dæ—¥" }}
                        </time>
                        {% if post.tags.size > 0 %}
                        <div class="post-tags">
                            {% for tag in post.tags limit: 3 %}
                            <span class="tag" data-tag="{{ tag | slugify }}">#{{ tag }}</span>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>
                </div>
                <div class="post-card-content">
                    {% if post.excerpt %}
                    <p>{{ post.excerpt | strip_html | truncatewords: 50 }}</p>
                    {% endif %}
                </div>
                <div class="post-card-footer">
                    <a href="{{ post.url | relative_url }}" class="read-more">é˜…è¯»å…¨æ–‡ <i class="fas fa-arrow-right"></i></a>
                </div>
            </article>
            {% endfor %}
            {% else %}
            <div style="text-align: center; padding: 4rem 0;">
                <p style="font-size: 1.2rem; color: var(--color-text-secondary);">æš‚æ— æ–‡ç« ï¼Œæ•¬è¯·æœŸå¾…ï¼</p>
        </div>
            {% endif %}
        </div>

        <!-- æ— ç»“æœæç¤º -->
        <div id="no-results" style="display: none; text-align: center; padding: 4rem 0;">
            <p style="font-size: 1.2rem; color: var(--color-text-secondary);">æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„æ–‡ç« </p>
            <button class="filter-btn" id="reset-filters-btn" style="margin-top: 1rem;">æ¸…é™¤ç­›é€‰</button>
        </div>
    </div>
</div>

<script>
// ç­›é€‰åŠŸèƒ½
let activeTag = 'all';
let activeYear = 'all';
let searchQuery = '';
let searchType = 'posts'; // 'posts' æˆ– 'wiki'

function filterPosts() {
    const posts = document.querySelectorAll('.post-card');
    let visibleCount = 0;

    posts.forEach(post => {
        const postTags = post.getAttribute('data-tags') || '';
        const postYear = post.getAttribute('data-year') || '';
        const postTitle = post.getAttribute('data-title') || '';
        const postContent = post.getAttribute('data-content') || '';

        let show = true;

        // æ ‡ç­¾ç­›é€‰
        if (activeTag !== 'all') {
            if (!postTags.includes(activeTag)) {
                show = false;
            }
        }

        // å¹´ä»½ç­›é€‰
        if (activeYear !== 'all') {
            if (postYear !== activeYear) {
                show = false;
            }
        }

        // æœç´¢ç­›é€‰ï¼ˆä»…åœ¨æœç´¢ç±»å‹ä¸º posts æ—¶ç”Ÿæ•ˆï¼‰
        if (searchType === 'posts' && searchQuery) {
            const query = searchQuery.toLowerCase();
            if (!postTitle.includes(query) && !postContent.includes(query)) {
                show = false;
            }
        }

        if (show) {
            post.style.display = 'flex';
            visibleCount++;
        } else {
            post.style.display = 'none';
        }
    });

    // æ˜¾ç¤º/éšè—æ— ç»“æœæç¤ºï¼ˆä»…åœ¨æœç´¢ç±»å‹ä¸º posts æ—¶æ˜¾ç¤ºï¼‰
    const noResults = document.getElementById('no-results');
    if (searchType === 'posts') {
        if (visibleCount === 0 && (searchQuery || activeTag !== 'all' || activeYear !== 'all')) {
            noResults.style.display = 'block';
        } else {
            noResults.style.display = 'none';
        }
    } else {
        noResults.style.display = 'none';
    }
}

// ç»´åŸºç™¾ç§‘æœç´¢å‡½æ•°ï¼ˆæ”¹è¿›ç‰ˆï¼šè·å–è¯¦ç»†æ‘˜è¦ï¼‰
function wikiSearch() {
    const query = document.getElementById('search-input').value.trim();
    const resultsDiv = document.getElementById('wiki-results');
    const postsList = document.getElementById('posts-list');
    
    if (!query) {
        resultsDiv.style.display = 'none';
        postsList.style.display = 'block';
        return;
    }
    
    // éšè—æ–‡ç« åˆ—è¡¨ï¼Œæ˜¾ç¤ºæœç´¢ç»“æœ
    postsList.style.display = 'none';
    resultsDiv.style.display = 'block';
    resultsDiv.innerHTML = '<div class="wiki-loading">ğŸ“¡ æ­£åœ¨æœç´¢ç»´åŸºç™¾ç§‘...</div>';
    
    // ç¬¬ä¸€æ­¥ï¼šä½¿ç”¨ search API æŸ¥æ‰¾ç›¸å…³æ–‡ç« 
    const searchUrl = `https://zh.wikipedia.org/w/api.php?action=query&list=search&srsearch=${encodeURIComponent(query)}&srlimit=8&srprop=size|wordcount|timestamp|snippet&format=json&origin=*&_=${Date.now()}`;
    
    fetch(searchUrl)
        .then(response => response.json())
        .then(data => {
            if (!data.query || !data.query.search || data.query.search.length === 0) {
                resultsDiv.innerHTML = '<div class="wiki-error">âŒ æœªæ‰¾åˆ°ç›¸å…³ç»“æœ</div>';
                return;
            }
            
            const searchResults = data.query.search;
            const titles = searchResults.map(item => item.title).join('|');
            
            // ç¬¬äºŒæ­¥ï¼šè·å–è¿™äº›æ–‡ç« çš„è¯¦ç»†æ‘˜è¦
            const extractUrl = `https://zh.wikipedia.org/w/api.php?action=query&titles=${encodeURIComponent(titles)}&prop=extracts|info&exintro=true&exchars=500&explaintext=true&inprop=url&format=json&origin=*&_=${Date.now()}`;
            
            return fetch(extractUrl)
                .then(response => response.json())
                .then(extractData => {
                    const pages = extractData.query.pages || {};
                    let html = `<div style="margin-bottom:15px"><strong>å…±æ‰¾åˆ° ${searchResults.length} ä¸ªç»“æœï¼š</strong></div><ul style="padding-left:0; list-style:none;">`;
                    
                    searchResults.forEach((item, index) => {
                        const pageId = String(item.pageid);
                        const page = pages[pageId] || Object.values(pages).find(p => p.title === item.title);
                        const extract = page && page.extract ? page.extract.trim() : '';
                        const url = page && page.fullurl ? page.fullurl : `https://zh.wikipedia.org/wiki/${encodeURIComponent(item.title)}`;
                        const wordcount = item.wordcount || 0;
                        const size = item.size || 0;
                        
                        // æ ¼å¼åŒ–æ‘˜è¦ï¼šä¼˜å…ˆä½¿ç”¨ extractï¼ˆæ›´è¯¦ç»†ï¼‰ï¼Œå¦åˆ™ä½¿ç”¨ snippet
                        let description = extract || (item.snippet ? item.snippet.replace(/<[^>]*>/g, '') : '');
                        // æ¸…ç†å¤šä½™çš„ç©ºç™½å­—ç¬¦
                        description = description.replace(/\s+/g, ' ').trim();
                        // é™åˆ¶é•¿åº¦ï¼ˆextract å¯èƒ½è¾ƒé•¿ï¼Œsnippet é€šå¸¸è¾ƒçŸ­ï¼‰
                        if (description.length > 400) {
                            description = description.substring(0, 400) + '...';
                        }
                        
                        // æ ¼å¼åŒ–æ—¥æœŸ
                        const updateDate = item.timestamp ? new Date(item.timestamp).toLocaleDateString('zh-CN', {
                            year: 'numeric',
                            month: 'long',
                            day: 'numeric'
                        }) : '';
                        
                        html += `
                            <li style="margin-bottom:20px; padding:15px; background:var(--color-bg-card); border:1px solid var(--color-border); border-radius:var(--radius-md); box-shadow:0 2px 4px rgba(0,0,0,0.05);">
                                <a href="${url}" target="_blank" rel="noopener" style="color:var(--color-accent);text-decoration:none;display:block;margin-bottom:10px;">
                                    <strong style="font-size:1.1rem;font-weight:600;">${item.title}</strong>
                                </a>
                                ${description ? `<div style="color:var(--color-text-primary);font-size:0.95rem;line-height:1.7;margin-top:10px;margin-bottom:12px;text-align:justify;">${description}</div>` : '<div style="color:var(--color-text-muted);font-size:0.9rem;margin-top:8px;margin-bottom:12px;">æš‚æ— æ‘˜è¦</div>'}
                                <div style="font-size:0.85rem;color:var(--color-text-muted);margin-top:12px;padding-top:10px;border-top:1px solid var(--color-border);display:flex;gap:15px;flex-wrap:wrap;align-items:center;">
                                    ${wordcount > 0 ? `<span title="æ–‡ç« å­—æ•°">ğŸ“ ${wordcount.toLocaleString()} å­—</span>` : ''}
                                    ${size > 0 ? `<span title="æ–‡ç« å¤§å°">ğŸ“„ ${(size / 1024).toFixed(1)} KB</span>` : ''}
                                    ${updateDate ? `<span title="æœ€åæ›´æ–°">ğŸ•’ ${updateDate}</span>` : ''}
                                </div>
                            </li>`;
                    });
                    
                    html += '</ul><div style="font-size:13px;color:var(--color-text-muted);margin-top:15px;text-align:center;padding-top:15px;border-top:1px solid var(--color-border);">ğŸ’¡ ç‚¹å‡»æ ‡é¢˜è·³è½¬è‡³ç»´åŸºç™¾ç§‘åŸæ–‡ï¼ˆæ–°æ ‡ç­¾é¡µï¼‰</div>';
                    resultsDiv.innerHTML = html;
                })
                .catch(error => {
                    console.error('è·å–æ‘˜è¦å¤±è´¥:', error);
                    resultsDiv.innerHTML = '<div class="wiki-error">âš ï¸ è·å–è¯¦ç»†å†…å®¹å¤±è´¥ï¼Œè¯·ç¨åå†è¯•</div>';
                });
        })
        .catch(error => {
            console.error('æœç´¢å¤±è´¥:', error);
            resultsDiv.innerHTML = '<div class="wiki-error">âš ï¸ ç»´åŸºç™¾ç§‘æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åå†è¯•</div>';
        });
}

// æ¸…é™¤ç­›é€‰å‡½æ•°
function resetFilters() {
    activeTag = 'all';
    activeYear = 'all';
    searchQuery = '';
    
    // é‡ç½®æŒ‰é’®çŠ¶æ€
    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.getAttribute('data-filter') === 'all') {
            btn.classList.add('active');
        }
    });
    
    // æ¸…ç©ºæœç´¢æ¡†
    document.getElementById('search-input').value = '';
    
    // é‡æ–°ç­›é€‰
    filterPosts();
}

// æ¸…é™¤ç­›é€‰æŒ‰é’®äº‹ä»¶
document.getElementById('reset-filters-btn')?.addEventListener('click', resetFilters);

// æ ‡ç­¾ç­›é€‰
document.querySelectorAll('[data-filter="tag"]').forEach(btn => {
    btn.addEventListener('click', function() {
        document.querySelectorAll('[data-filter="tag"], [data-filter="all"]').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        activeTag = this.getAttribute('data-value');
        filterPosts();
    });
});

// å¹´ä»½ç­›é€‰
document.querySelectorAll('[data-filter="year"]').forEach(btn => {
    btn.addEventListener('click', function() {
        document.querySelectorAll('[data-filter="year"], [data-filter="all"]').forEach(b => {
            if (b.closest('.year-filter')) {
                b.classList.remove('active');
            }
        });
        this.classList.add('active');
        activeYear = this.getAttribute('data-value');
        filterPosts();
    });
});

// å…¨éƒ¨æŒ‰é’® - æ ‡ç­¾ç­›é€‰
document.querySelectorAll('.tags-filter [data-filter="all"]').forEach(btn => {
    btn.addEventListener('click', function() {
        document.querySelectorAll('.tags-filter .filter-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        activeTag = 'all';
        filterPosts();
    });
});

// å…¨éƒ¨æŒ‰é’® - å¹´ä»½ç­›é€‰
document.querySelectorAll('.year-filter [data-filter="all"]').forEach(btn => {
    btn.addEventListener('click', function() {
        document.querySelectorAll('.year-filter .filter-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        activeYear = 'all';
        filterPosts();
    });
});

// æœç´¢ç±»å‹åˆ‡æ¢
document.querySelectorAll('input[name="search-type"]').forEach(radio => {
    radio.addEventListener('change', function() {
        searchType = this.value;
        const searchInput = document.getElementById('search-input');
        const wikiResults = document.getElementById('wiki-results');
        const postsList = document.getElementById('posts-list');
        
        if (searchType === 'posts') {
            searchInput.placeholder = 'æœç´¢æ–‡ç« æ ‡é¢˜æˆ–å†…å®¹...';
            wikiResults.style.display = 'none';
            postsList.style.display = 'block';
            // å¦‚æœæœ‰æœç´¢å†…å®¹ï¼Œé‡æ–°ç­›é€‰æ–‡ç« 
            if (searchInput.value.trim()) {
                searchQuery = searchInput.value.trim();
                filterPosts();
            } else {
                filterPosts();
            }
        } else {
            searchInput.placeholder = 'æœç´¢ç»´åŸºç™¾ç§‘...';
            wikiResults.style.display = 'none';
            postsList.style.display = 'block';
            // å¦‚æœæœ‰æœç´¢å†…å®¹ï¼Œæ‰§è¡Œç»´åŸºç™¾ç§‘æœç´¢
            if (searchInput.value.trim()) {
                wikiSearch();
            }
        }
    });
});

// æœç´¢åŠŸèƒ½
const searchInput = document.getElementById('search-input');
searchInput.addEventListener('input', function(e) {
    const query = e.target.value.trim();
    const wikiResults = document.getElementById('wiki-results');
    const postsList = document.getElementById('posts-list');
    
    if (searchType === 'posts') {
        searchQuery = query;
        filterPosts();
    } else {
        // ç»´åŸºç™¾ç§‘æœç´¢ï¼šå¦‚æœæœç´¢æ¡†ä¸ºç©ºï¼Œæ˜¾ç¤ºæ–‡ç« åˆ—è¡¨
        if (!query) {
            wikiResults.style.display = 'none';
            postsList.style.display = 'block';
            return;
        }
        
        // ç»´åŸºç™¾ç§‘æœç´¢ï¼šå»¶è¿Ÿæ‰§è¡Œï¼Œé¿å…é¢‘ç¹è¯·æ±‚
        clearTimeout(searchInput.wikiSearchTimeout);
        searchInput.wikiSearchTimeout = setTimeout(() => {
            wikiSearch();
        }, 500); // 500ms å»¶è¿Ÿ
    }
});

// å›è½¦é”®æœç´¢ï¼ˆç»´åŸºç™¾ç§‘ï¼‰
searchInput.addEventListener('keydown', function(e) {
    if (e.key === 'Enter' && searchType === 'wiki') {
        e.preventDefault();
        clearTimeout(searchInput.wikiSearchTimeout);
        wikiSearch();
    }
});
</script>


---
layout: default
---
<div class="blog-page">
    <div class="container">
        <header class="page-header" style="text-align: center; margin-bottom: 3rem; padding-top: 2rem;">
            <h1>åšå®¢æ–‡ç« </h1>
            <p style="font-size: 1.1rem; margin-top: 1rem; opacity: 0.8;">åˆ†äº«æŠ€æœ¯è§è§£å’Œå­¦ä¹ ç¬”è®°</p>
        </header>

        <!-- ç­›é€‰å™¨ -->
        <div class="blog-filters">
            <!-- æ ‡ç­¾ç­›é€‰ -->
            <div class="filter-section">
                <h3 class="filter-title">æ ‡ç­¾ç­›é€‰</h3>
                <div class="tags-filter">
                    <button class="filter-btn active" data-filter="all">å…¨éƒ¨</button>
                    {% assign all_tags = '' | split: '' %}
                    {% for post in site.posts %}
                        {% for tag in post.tags %}
                            {% unless all_tags contains tag %}
                                {% assign all_tags = all_tags | push: tag %}
                            {% endunless %}
                        {% endfor %}
                    {% endfor %}
                    {% assign all_tags = all_tags | sort %}
                    {% for tag in all_tags %}
                    {% assign tag_posts = site.posts | where_exp: "post", "post.tags contains tag" %}
                    <button class="filter-btn" data-filter="tag" data-value="{{ tag | slugify }}">
                        {{ tag }} <span class="filter-count">({{ tag_posts.size }})</span>
                    </button>
                    {% endfor %}
                </div>
            </div>

            <!-- æ—¶é—´ç­›é€‰ -->
            <div class="filter-section">
                <h3 class="filter-title">æ—¶é—´ç­›é€‰</h3>
                <div class="year-filter">
                    <button class="filter-btn active" data-filter="all">å…¨éƒ¨</button>
                    {% assign posts_by_year = site.posts | group_by_exp: "post", "post.date | date: '%Y'" %}
                    {% for year in posts_by_year %}
                    <button class="filter-btn" data-filter="year" data-value="{{ year.name }}">
                        {{ year.name }}å¹´ <span class="filter-count">({{ year.items.size }})</span>
                    </button>
                    {% endfor %}
                </div>
            </div>

            <!-- æœç´¢æ¡† -->
            <div class="filter-section">
                <h3 class="filter-title">æœç´¢</h3>
                <!-- æœç´¢ç±»å‹åˆ‡æ¢ -->
                <div class="search-type-toggle">
                    <label class="search-type-option">
                        <input type="radio" name="search-type" value="posts" checked>
                        <span>æœç´¢æ–‡ç« æ ‡é¢˜æˆ–å†…å®¹</span>
                    </label>
                    <label class="search-type-option">
                        <input type="radio" name="search-type" value="wiki">
                        <span>æœç´¢ç»´åŸºç™¾ç§‘</span>
                    </label>
                </div>
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="search-input" placeholder="æœç´¢æ–‡ç« æ ‡é¢˜æˆ–å†…å®¹..." class="search-input">
                </div>
                <!-- ç»´åŸºç™¾ç§‘æœç´¢ç»“æœ -->
                <div id="wiki-results" class="wiki-results" style="display: none;"></div>
            </div>
        </div>

        <!-- æ–‡ç« åˆ—è¡¨ -->
        <div class="posts-list" id="posts-list">
            {% if site.posts.size > 0 %}
            {% for post in site.posts %}
            <article class="post-card" 
                     data-tags="{% for tag in post.tags %}{{ tag | slugify }} {% endfor %}"
                     data-year="{{ post.date | date: '%Y' }}"
                     data-title="{{ post.title | downcase }}"
                     data-content="{{ post.excerpt | strip_html | downcase }}">
                <div class="post-card-header">
                    <h2><a href="{{ post.url | relative_url }}">{{ post.title }}</a></h2>
                    <div class="post-meta">
                        <time datetime="{{ post.date | date: '%Y-%m-%d' }}">
                            <i class="far fa-calendar"></i> {{ post.date | date: "%Yå¹´%mæœˆ%dæ—¥" }}
                        </time>
                        {% if post.tags.size > 0 %}
                        <div class="post-tags">
                            {% for tag in post.tags limit: 3 %}
                            <span class="tag" data-tag="{{ tag | slugify }}">#{{ tag }}</span>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>
                </div>
                <div class="post-card-content">
                    {% if post.excerpt %}
                    <p>{{ post.excerpt | strip_html | truncatewords: 50 }}</p>
                    {% endif %}
                </div>
                <div class="post-card-footer">
                    <a href="{{ post.url | relative_url }}" class="read-more">é˜…è¯»å…¨æ–‡ <i class="fas fa-arrow-right"></i></a>
                </div>
            </article>
            {% endfor %}
            {% else %}
            <div style="text-align: center; padding: 4rem 0;">
                <p style="font-size: 1.2rem; color: var(--color-text-secondary);">æš‚æ— æ–‡ç« ï¼Œæ•¬è¯·æœŸå¾…ï¼</p>
        </div>
            {% endif %}
        </div>

        <!-- æ— ç»“æœæç¤º -->
        <div id="no-results" style="display: none; text-align: center; padding: 4rem 0;">
            <p style="font-size: 1.2rem; color: var(--color-text-secondary);">æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„æ–‡ç« </p>
            <button class="filter-btn" id="reset-filters-btn" style="margin-top: 1rem;">æ¸…é™¤ç­›é€‰</button>
        </div>
    </div>
</div>

<script>
// ç­›é€‰åŠŸèƒ½
let activeTag = 'all';
let activeYear = 'all';
let searchQuery = '';
let searchType = 'posts'; // 'posts' æˆ– 'wiki'

function filterPosts() {
    const posts = document.querySelectorAll('.post-card');
    let visibleCount = 0;

    posts.forEach(post => {
        const postTags = post.getAttribute('data-tags') || '';
        const postYear = post.getAttribute('data-year') || '';
        const postTitle = post.getAttribute('data-title') || '';
        const postContent = post.getAttribute('data-content') || '';

        let show = true;

        // æ ‡ç­¾ç­›é€‰
        if (activeTag !== 'all') {
            if (!postTags.includes(activeTag)) {
                show = false;
            }
        }

        // å¹´ä»½ç­›é€‰
        if (activeYear !== 'all') {
            if (postYear !== activeYear) {
                show = false;
            }
        }

        // æœç´¢ç­›é€‰ï¼ˆä»…åœ¨æœç´¢ç±»å‹ä¸º posts æ—¶ç”Ÿæ•ˆï¼‰
        if (searchType === 'posts' && searchQuery) {
            const query = searchQuery.toLowerCase();
            if (!postTitle.includes(query) && !postContent.includes(query)) {
                show = false;
            }
        }

        if (show) {
            post.style.display = 'flex';
            visibleCount++;
        } else {
            post.style.display = 'none';
        }
    });

    // æ˜¾ç¤º/éšè—æ— ç»“æœæç¤ºï¼ˆä»…åœ¨æœç´¢ç±»å‹ä¸º posts æ—¶æ˜¾ç¤ºï¼‰
    const noResults = document.getElementById('no-results');
    if (searchType === 'posts') {
        if (visibleCount === 0 && (searchQuery || activeTag !== 'all' || activeYear !== 'all')) {
            noResults.style.display = 'block';
        } else {
            noResults.style.display = 'none';
        }
    } else {
        noResults.style.display = 'none';
    }
}

// ç»´åŸºç™¾ç§‘æœç´¢å‡½æ•°
function wikiSearch() {
    const query = document.getElementById('search-input').value.trim();
    const resultsDiv = document.getElementById('wiki-results');
    const postsList = document.getElementById('posts-list');
    
    if (!query) {
        resultsDiv.style.display = 'none';
        postsList.style.display = 'block';
        return;
    }
    
    // éšè—æ–‡ç« åˆ—è¡¨ï¼Œæ˜¾ç¤ºæœç´¢ç»“æœ
    postsList.style.display = 'none';
    resultsDiv.style.display = 'block';
    resultsDiv.innerHTML = '<div class="wiki-loading">ğŸ“¡ æ­£åœ¨æœç´¢ç»´åŸºç™¾ç§‘...</div>';
    
    // ç”Ÿæˆå”¯ä¸€å›è°ƒå‡½æ•°åï¼ˆé˜²å†²çªï¼‰
    const cbName = 'wikiCallback_' + Date.now();
    const scriptId = 'wikiScript_' + Date.now();
    
    // åˆ›å»º JSONP è„šæœ¬
    const script = document.createElement('script');
    script.id = scriptId;
    script.src = `https://zh.wikipedia.org/w/api.php?action=opensearch&search=${encodeURIComponent(query)}&limit=8&format=json&callback=${cbName}&_=${Date.now()}`;
    
    // å®šä¹‰å›è°ƒå‡½æ•°
    window[cbName] = function(data) {
        // data[1]=æ ‡é¢˜, data[2]=æ‘˜è¦(éƒ¨åˆ†æœ‰), data[3]=URL
        if (!data[1] || data[1].length === 0) {
            resultsDiv.innerHTML = '<div class="wiki-error">âŒ æœªæ‰¾åˆ°ç›¸å…³ç»“æœ</div>';
            cleanup();
            return;
        }
        
        // ç”Ÿæˆç»“æœ HTML
        let html = `<div style="margin-bottom:10px"><strong>å…±æ‰¾åˆ° ${data[1].length} ä¸ªç»“æœï¼š</strong></div><ul style="padding-left:20px; list-style:none;">`;
        for (let i = 0; i < data[1].length; i++) {
            // ä¼˜å…ˆä½¿ç”¨ data[2] çš„æ‘˜è¦ï¼ˆå¦‚æœæœ‰ï¼‰
            const desc = data[2][i] ? `<div style="color:var(--color-text-secondary);font-size:14px;margin-top:3px">${data[2][i]}</div>` : '';
            html += `
                <li style="margin-bottom:12px; padding-bottom:12px; border-bottom:1px solid var(--color-border);">
                    <a href="${data[3][i]}" target="_blank" rel="noopener" style="color:var(--color-accent);text-decoration:none;display:block;">
                        <strong style="font-size:1rem;">${data[1][i]}</strong>
                    </a>
                    ${desc}
                </li>`;
        }
        html += '</ul><div style="font-size:13px;color:var(--color-text-muted);margin-top:10px">ğŸ’¡ ç‚¹å‡»æ ‡é¢˜è·³è½¬è‡³ç»´åŸºç™¾ç§‘åŸæ–‡ï¼ˆæ–°æ ‡ç­¾é¡µï¼‰</div>';
        resultsDiv.innerHTML = html;
        cleanup();
    };
    
    // é”™è¯¯å¤„ç†
    script.onerror = () => {
        resultsDiv.innerHTML = '<div class="wiki-error">âš ï¸ ç»´åŸºç™¾ç§‘æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åå†è¯•</div>';
        cleanup();
    };
    
    // æ¸…ç†å‡½æ•°ï¼ˆç§»é™¤è„šæœ¬+å›è°ƒï¼‰
    function cleanup() {
        if (document.getElementById(scriptId)) {
            document.body.removeChild(document.getElementById(scriptId));
        }
        delete window[cbName];
    }
    
    // è¶…æ—¶ä¿æŠ¤ï¼ˆ5ç§’ï¼‰
    setTimeout(() => {
        if (document.getElementById(scriptId)) {
            resultsDiv.innerHTML = '<div class="wiki-error">â±ï¸ è¯·æ±‚è¶…æ—¶ï¼Œè¯·é‡è¯•</div>';
            cleanup();
        }
    }, 5000);
    
    // æ³¨å…¥è„šæœ¬
    document.body.appendChild(script);
}

// æ¸…é™¤ç­›é€‰å‡½æ•°
function resetFilters() {
    activeTag = 'all';
    activeYear = 'all';
    searchQuery = '';
    
    // é‡ç½®æŒ‰é’®çŠ¶æ€
    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.getAttribute('data-filter') === 'all') {
            btn.classList.add('active');
        }
    });
    
    // æ¸…ç©ºæœç´¢æ¡†
    document.getElementById('search-input').value = '';
    
    // é‡æ–°ç­›é€‰
    filterPosts();
}

// æ¸…é™¤ç­›é€‰æŒ‰é’®äº‹ä»¶
document.getElementById('reset-filters-btn')?.addEventListener('click', resetFilters);

// æ ‡ç­¾ç­›é€‰
document.querySelectorAll('[data-filter="tag"]').forEach(btn => {
    btn.addEventListener('click', function() {
        document.querySelectorAll('[data-filter="tag"], [data-filter="all"]').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        activeTag = this.getAttribute('data-value');
        filterPosts();
    });
});

// å¹´ä»½ç­›é€‰
document.querySelectorAll('[data-filter="year"]').forEach(btn => {
    btn.addEventListener('click', function() {
        document.querySelectorAll('[data-filter="year"], [data-filter="all"]').forEach(b => {
            if (b.closest('.year-filter')) {
                b.classList.remove('active');
            }
        });
        this.classList.add('active');
        activeYear = this.getAttribute('data-value');
        filterPosts();
    });
});

// å…¨éƒ¨æŒ‰é’® - æ ‡ç­¾ç­›é€‰
document.querySelectorAll('.tags-filter [data-filter="all"]').forEach(btn => {
    btn.addEventListener('click', function() {
        document.querySelectorAll('.tags-filter .filter-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        activeTag = 'all';
        filterPosts();
    });
});

// å…¨éƒ¨æŒ‰é’® - å¹´ä»½ç­›é€‰
document.querySelectorAll('.year-filter [data-filter="all"]').forEach(btn => {
    btn.addEventListener('click', function() {
        document.querySelectorAll('.year-filter .filter-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        activeYear = 'all';
        filterPosts();
    });
});

// æœç´¢ç±»å‹åˆ‡æ¢
document.querySelectorAll('input[name="search-type"]').forEach(radio => {
    radio.addEventListener('change', function() {
        searchType = this.value;
        const searchInput = document.getElementById('search-input');
        const wikiResults = document.getElementById('wiki-results');
        const postsList = document.getElementById('posts-list');
        
        if (searchType === 'posts') {
            searchInput.placeholder = 'æœç´¢æ–‡ç« æ ‡é¢˜æˆ–å†…å®¹...';
            wikiResults.style.display = 'none';
            postsList.style.display = 'block';
            // å¦‚æœæœ‰æœç´¢å†…å®¹ï¼Œé‡æ–°ç­›é€‰æ–‡ç« 
            if (searchInput.value.trim()) {
                searchQuery = searchInput.value.trim();
                filterPosts();
            } else {
                filterPosts();
            }
        } else {
            searchInput.placeholder = 'ğŸ” æœç´¢ç»´åŸºç™¾ç§‘ï¼ˆå¦‚ï¼šäººå·¥æ™ºèƒ½ã€é‡å­è®¡ç®—ï¼‰';
            wikiResults.style.display = 'none';
            postsList.style.display = 'block';
            // å¦‚æœæœ‰æœç´¢å†…å®¹ï¼Œæ‰§è¡Œç»´åŸºç™¾ç§‘æœç´¢
            if (searchInput.value.trim()) {
                wikiSearch();
            }
        }
    });
});

// æœç´¢åŠŸèƒ½
const searchInput = document.getElementById('search-input');
searchInput.addEventListener('input', function(e) {
    const query = e.target.value.trim();
    const wikiResults = document.getElementById('wiki-results');
    const postsList = document.getElementById('posts-list');
    
    if (searchType === 'posts') {
        searchQuery = query;
        filterPosts();
    } else {
        // ç»´åŸºç™¾ç§‘æœç´¢ï¼šå¦‚æœæœç´¢æ¡†ä¸ºç©ºï¼Œæ˜¾ç¤ºæ–‡ç« åˆ—è¡¨
        if (!query) {
            wikiResults.style.display = 'none';
            postsList.style.display = 'block';
            return;
        }
        
        // ç»´åŸºç™¾ç§‘æœç´¢ï¼šå»¶è¿Ÿæ‰§è¡Œï¼Œé¿å…é¢‘ç¹è¯·æ±‚
        clearTimeout(searchInput.wikiSearchTimeout);
        searchInput.wikiSearchTimeout = setTimeout(() => {
            wikiSearch();
        }, 500); // 500ms å»¶è¿Ÿ
    }
});

// å›è½¦é”®æœç´¢ï¼ˆç»´åŸºç™¾ç§‘ï¼‰
searchInput.addEventListener('keydown', function(e) {
    if (e.key === 'Enter' && searchType === 'wiki') {
        e.preventDefault();
        clearTimeout(searchInput.wikiSearchTimeout);
        wikiSearch();
    }
});
</script>

